è¯»å®Œæœ¬æ–‡ï¼Œä½ ä¸ä»…å­¦ä¼šäº†ç®—æ³•å¥—è·¯ï¼Œè¿˜å¯ä»¥é¡ºä¾¿è§£å†³å¦‚ä¸‹é¢˜ç›®ï¼š

|                           LeetCode                           |                             åŠ›æ‰£                             | éš¾åº¦ |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :--: |
| [677. Map Sum Pairs](https://leetcode.com/problems/map-sum-pairs/) | [677. é”®å€¼æ˜ å°„](https://leetcode.cn/problems/map-sum-pairs/) |  ğŸŸ    |
| [648. Replace Words](https://leetcode.com/problems/replace-words/) | [648. å•è¯æ›¿æ¢](https://leetcode.cn/problems/replace-words/) |  ğŸŸ    |
|                              -                               | [å‰‘æŒ‡ Offer II 062. å®ç°å‰ç¼€æ ‘](https://leetcode.cn/problems/QC3q1f/) |  ğŸŸ    |
| [208. Implement Trie (Prefix Tree)](https://leetcode.com/problems/implement-trie-prefix-tree/) | [208. å®ç° Trie (å‰ç¼€æ ‘)](https://leetcode.cn/problems/implement-trie-prefix-tree/) |  ğŸŸ    |
| [1804. Implement Trie II (Prefix Tree)](https://leetcode.com/problems/implement-trie-ii-prefix-tree/)ğŸ”’ | [1804. å®ç° Trie ï¼ˆå‰ç¼€æ ‘ï¼‰ II](https://leetcode.cn/problems/implement-trie-ii-prefix-tree/)ğŸ”’ |  ğŸŸ    |
|                              -                               | [å‰‘æŒ‡ Offer II 066. å•è¯ä¹‹å’Œ](https://leetcode.cn/problems/z1R5dt/) |  ğŸŸ    |
| [211. Design Add and Search Words Data Structure](https://leetcode.com/problems/design-add-and-search-words-data-structure/) | [211. æ·»åŠ ä¸æœç´¢å•è¯ - æ•°æ®ç»“æ„è®¾è®¡](https://leetcode.cn/problems/design-add-and-search-words-data-structure/) |  ğŸŸ    |
|                              -                               | [å‰‘æŒ‡ Offer II 063. æ›¿æ¢å•è¯](https://leetcode.cn/problems/UhWRSj/) |  ğŸŸ    |

**-----------**

> æœ¬æ–‡æœ‰è§†é¢‘ç‰ˆï¼š[åŠ¨æ‰‹å®ç°å­—å…¸æ ‘](https://appktavsiei5995.pc.xiaoe-tech.com/detail/p_6265562be4b01c509aa7b629/6)

Trie æ ‘åˆå«å­—å…¸æ ‘ã€å‰ç¼€æ ‘ã€å•è¯æŸ¥æ‰¾æ ‘ï¼Œæ˜¯ä¸€ç§äºŒå‰æ ‘è¡ç”Ÿå‡ºæ¥çš„é«˜çº§æ•°æ®ç»“æ„ï¼Œä¸»è¦åº”ç”¨åœºæ™¯æ˜¯å¤„ç†å­—ç¬¦ä¸²å‰ç¼€ç›¸å…³çš„æ“ä½œã€‚

æˆ‘æ˜¯åœ¨ã€Šç®—æ³• 4ã€‹ç¬¬ä¸€æ¬¡å­¦åˆ°è¿™ç§æ•°æ®ç»“æ„ï¼Œä¸è¿‡ä¹¦ä¸­çš„è®²è§£ä¸æ˜¯ç‰¹åˆ«é€šä¿—æ˜“æ‡‚ï¼Œæ‰€ä»¥æœ¬æ–‡æŒ‰ç…§æˆ‘çš„é€»è¾‘å¸®å¤§å®¶é‡æ–°æ¢³ç†ä¸€é Trie æ ‘çš„åŸç†ï¼Œå¹¶åŸºäºã€Šç®—æ³• 4ã€‹çš„ä»£ç å®ç°ä¸€å¥—æ›´é€šç”¨æ˜“æ‡‚çš„ä»£ç æ¨¡æ¿ï¼Œç”¨äºå¤„ç†åŠ›æ‰£ä¸Šä¸€ç³»åˆ—å­—ç¬¦ä¸²å‰ç¼€é—®é¢˜ã€‚

é˜…è¯»æœ¬æ–‡ä¹‹å‰å¸Œæœ›ä½ è¯»è¿‡æˆ‘æ—§æ–‡è®²è¿‡çš„ [å›æº¯ç®—æ³•ä»£ç æ¨¡æ¿](https://labuladong.github.io/article/fname.html?fname=å›æº¯ç®—æ³•è¯¦è§£ä¿®è®¢ç‰ˆ) å’Œ [æ‰‹æŠŠæ‰‹åˆ·äºŒå‰æ ‘ï¼ˆæ€»ç»“ç¯‡ï¼‰](https://appktavsiei5995.pc.xiaoe-tech.com/detail/i_63a84ecde4b030cacaff6731/1)ã€‚

æœ¬æ–‡ä¸»è¦åˆ†ä¸‰éƒ¨åˆ†ï¼š

**1ã€è®²è§£ Trie æ ‘çš„å·¥ä½œåŸç†**ã€‚

**2ã€ç»™å‡ºä¸€å¥— `TrieMap` å’Œ `TrieSet` çš„ä»£ç æ¨¡æ¿ï¼Œå®ç°å‡ ä¸ªå¸¸ç”¨ API**ã€‚

**3ã€å®è·µç¯èŠ‚ï¼Œç›´æ¥å¥—ä»£ç æ¨¡æ¿ç§’æ€ 5 é“ç®—æ³•é¢˜**ã€‚æœ¬æ¥å¯ä»¥ç§’æ€ä¸ƒå…«é“é¢˜ï¼Œç¯‡å¹…è€ƒè™‘ï¼Œå‰©ä¸‹çš„æˆ‘é›†æˆåˆ° [åˆ·é¢˜æ’ä»¶](https://mp.weixin.qq.com/s/uOubir_nLzQtp_fWHL73JA) ä¸­ã€‚

å…³äº `Map` å’Œ `Set`ï¼Œæ˜¯ä¸¤ä¸ªæŠ½è±¡æ•°æ®ç»“æ„ï¼ˆæ¥å£ï¼‰ï¼Œ`Map` å­˜å‚¨ä¸€ä¸ªé”®å€¼å¯¹é›†åˆï¼Œå…¶ä¸­é”®ä¸é‡å¤ï¼Œ`Set` å­˜å‚¨ä¸€ä¸ªä¸é‡å¤çš„å…ƒç´ é›†åˆã€‚

å¸¸è§çš„ `Map` å’Œ `Set` çš„åº•å±‚å®ç°åŸç†æœ‰å“ˆå¸Œè¡¨å’ŒäºŒå‰æœç´¢æ ‘ä¸¤ç§ï¼Œæ¯”å¦‚ Java çš„ HashMap/HashSet å’Œ C++ çš„ unorderd_map/unordered_set åº•å±‚å°±æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°ï¼Œè€Œ Java çš„ TreeMap/TreeSet å’Œ C++ çš„ map/set åº•å±‚ä½¿ç”¨çº¢é»‘æ ‘è¿™ç§è‡ªå¹³è¡¡ BST å®ç°çš„ã€‚

è€Œæœ¬æ–‡å®ç°çš„ TrieSet/TrieMap åº•å±‚åˆ™ç”¨ Trie æ ‘è¿™ç§ç»“æ„æ¥å®ç°ã€‚

äº†è§£æ•°æ®ç»“æ„çš„è¯»è€…åº”è¯¥çŸ¥é“ï¼Œæœ¬è´¨ä¸Š `Set` å¯ä»¥è§†ä¸ºä¸€ç§ç‰¹æ®Šçš„ `Map`ï¼Œ`Set` å…¶å®å°±æ˜¯ `Map` ä¸­çš„é”®ã€‚

**æ‰€ä»¥æœ¬æ–‡å…ˆå®ç° `TrieMap`ï¼Œç„¶ååœ¨ `TrieMap` çš„åŸºç¡€ä¸Šå°è£…å‡º `TrieSet`**ã€‚

> PSï¼šä¸ºäº†æ¨¡æ¿é€šç”¨æ€§çš„è€ƒè™‘ï¼Œåæ–‡ä¼šç”¨åˆ° Java çš„æ³›å‹ï¼Œä¹Ÿå°±æ˜¯ç”¨å°–æ‹¬å· `<>` æŒ‡å®šçš„ç±»å‹å˜é‡ã€‚è¿™äº›ç±»å‹å˜é‡çš„ä½œç”¨æ˜¯æŒ‡å®šæˆ‘ä»¬å®ç°çš„å®¹å™¨ä¸­å­˜å‚¨çš„æ•°æ®ç±»å‹ï¼Œç±»æ¯” Java æ ‡å‡†åº“çš„é‚£äº›å®¹å™¨çš„ç”¨æ³•åº”è¯¥ä¸éš¾ç†è§£ã€‚

å‰æ–‡ [å­¦ä¹ æ•°æ®ç»“æ„çš„æ¡†æ¶æ€ç»´](https://labuladong.github.io/article/fname.html?fname=å­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•çš„é«˜æ•ˆæ–¹æ³•) è¯´è¿‡ï¼Œå„ç§ä¹±ä¸ƒå…«ç³Ÿçš„ç»“æ„éƒ½æ˜¯ä¸ºäº†åœ¨ã€Œç‰¹å®šåœºæ™¯ã€ä¸‹å°½å¯èƒ½é«˜æ•ˆåœ°è¿›è¡Œå¢åˆ æŸ¥æ”¹ã€‚

ä½ æ¯”å¦‚ `HashMap<K, V>` çš„ä¼˜åŠ¿æ˜¯èƒ½å¤Ÿåœ¨ O(1) æ—¶é—´é€šè¿‡é”®æŸ¥æ‰¾å¯¹åº”çš„å€¼ï¼Œä½†è¦æ±‚é”®çš„ç±»å‹ `K` å¿…é¡»æ˜¯ã€Œå¯å“ˆå¸Œã€çš„ï¼›è€Œ `TreeMap<K, V>` çš„ç‰¹ç‚¹æ˜¯æ–¹ä¾¿æ ¹æ®é”®çš„å¤§å°è¿›è¡Œæ“ä½œï¼Œä½†è¦æ±‚é”®çš„ç±»å‹ `K` å¿…é¡»æ˜¯ã€Œå¯æ¯”è¾ƒã€çš„ã€‚

æœ¬æ–‡è¦å®ç°çš„ `TrieMap` ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œç”±äº Trie æ ‘åŸç†ï¼Œæˆ‘ä»¬è¦æ±‚ `TrieMap<V>` çš„é”®å¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå€¼çš„ç±»å‹ `V` å¯ä»¥éšæ„ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬äº†è§£ä¸€ä¸‹ Trie æ ‘çš„åŸç†ï¼Œçœ‹çœ‹ä¸ºä»€ä¹ˆè¿™ç§æ•°æ®ç»“æ„èƒ½å¤Ÿé«˜æ•ˆæ“ä½œå­—ç¬¦ä¸²ã€‚

### Trie æ ‘åŸç†

**Trie æ ‘æœ¬è´¨ä¸Šå°±æ˜¯ä¸€æ£µä»äºŒå‰æ ‘è¡ç”Ÿå‡ºæ¥çš„å¤šå‰æ ‘**ã€‚

äºŒå‰æ ‘èŠ‚ç‚¹çš„ä»£ç å®ç°æ˜¯è¿™æ ·ï¼š

Copy

```java
/* åŸºæœ¬çš„äºŒå‰æ ‘èŠ‚ç‚¹ */
class TreeNode {
    int val;
    TreeNode left, right;
}
```

å…¶ä¸­ `left, right` å­˜å‚¨å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œæ‰€ä»¥äºŒå‰æ ‘çš„ç»“æ„æ˜¯è¿™æ ·ï¼š

![img](images/1-20230421211434918.jpeg)

å¤šå‰æ ‘èŠ‚ç‚¹çš„ä»£ç å®ç°æ˜¯è¿™æ ·ï¼š

Copy

```java
/* åŸºæœ¬çš„å¤šå‰æ ‘èŠ‚ç‚¹ */
class TreeNode {
    int val;
    TreeNode[] children;
}
```

å…¶ä¸­ `children` æ•°ç»„ä¸­å­˜å‚¨æŒ‡å‘å­©å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œæ‰€ä»¥å¤šå‰æ ‘çš„ç»“æ„æ˜¯è¿™æ ·ï¼š

![img](images/2-20230421211434919.jpeg)

è€Œ `TrieMap` ä¸­çš„æ ‘èŠ‚ç‚¹ `TrieNode` çš„ä»£ç å®ç°æ˜¯è¿™æ ·ï¼š

Copy

```java
/* Trie æ ‘èŠ‚ç‚¹å®ç° */
class TrieNode<V> {
    V val = null;
    TrieNode<V>[] children = new TrieNode[256];
}
```

è¿™ä¸ª `val` å­—æ®µå­˜å‚¨é”®å¯¹åº”çš„å€¼ï¼Œ`children` æ•°ç»„å­˜å‚¨æŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚

**ä½†æ˜¯å’Œä¹‹å‰çš„æ™®é€šå¤šå‰æ ‘èŠ‚ç‚¹ä¸åŒï¼Œ`TrieNode` ä¸­ `children` æ•°ç»„çš„ç´¢å¼•æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä»£è¡¨é”®ä¸­çš„ä¸€ä¸ªå­—ç¬¦**ã€‚

æ¯”å¦‚è¯´ `children[97]` å¦‚æœéç©ºï¼Œè¯´æ˜è¿™é‡Œå­˜å‚¨äº†ä¸€ä¸ªå­—ç¬¦ `'a'`ï¼Œå› ä¸º `'a'` çš„ ASCII ç ä¸º 97ã€‚

æˆ‘ä»¬çš„æ¨¡æ¿åªè€ƒè™‘å¤„ç† ASCII å­—ç¬¦ï¼Œæ‰€ä»¥ `children` æ•°ç»„çš„å¤§å°è®¾ç½®ä¸º 256ã€‚ä¸è¿‡è¿™ä¸ªå¯ä»¥æ ¹æ®å…·ä½“é—®é¢˜ä¿®æ”¹ï¼Œæ¯”å¦‚æ”¹æˆæ›´å°çš„æ•°ç»„æˆ–è€… `HashMap<Character, TrieNode>` éƒ½æ˜¯ä¸€æ ·çš„æ•ˆæœã€‚

æœ‰äº†ä»¥ä¸Šé“ºå«ï¼ŒTrie æ ‘çš„ç»“æ„æ˜¯è¿™æ ·çš„ï¼š

![img](images/3-20230421211434911.jpeg)

ä¸€ä¸ªèŠ‚ç‚¹æœ‰ 256 ä¸ªå­èŠ‚ç‚¹æŒ‡é’ˆï¼Œä½†å¤§å¤šæ•°æ—¶å€™éƒ½æ˜¯ç©ºçš„ï¼Œå¯ä»¥çœç•¥æ‰ä¸ç”»ï¼Œ**æ‰€ä»¥ä¸€èˆ¬ä½ çœ‹åˆ°çš„ Trie æ ‘é•¿è¿™æ ·**ï¼š

![img](images/9.jpeg)

è¿™æ˜¯åœ¨ `TrieMap<Integer>` ä¸­æ’å…¥ä¸€äº›é”®å€¼å¯¹åçš„æ ·å­ï¼Œç™½è‰²èŠ‚ç‚¹ä»£è¡¨ `val` å­—æ®µä¸ºç©ºï¼Œæ©™è‰²èŠ‚ç‚¹ä»£è¡¨ `val` å­—æ®µéç©ºã€‚

**è¿™é‡Œè¦ç‰¹åˆ«æ³¨æ„ï¼Œ`TrieNode` èŠ‚ç‚¹æœ¬èº«åªå­˜å‚¨ `val` å­—æ®µï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªå­—æ®µæ¥å­˜å‚¨å­—ç¬¦ï¼Œå­—ç¬¦æ˜¯é€šè¿‡å­èŠ‚ç‚¹åœ¨çˆ¶èŠ‚ç‚¹çš„ `children` æ•°ç»„ä¸­çš„ç´¢å¼•ç¡®å®šçš„**ã€‚

**å½¢è±¡ç†è§£å°±æ˜¯ï¼ŒTrie æ ‘ç”¨ã€Œæ ‘æã€å­˜å‚¨å­—ç¬¦ä¸²ï¼ˆé”®ï¼‰ï¼Œç”¨ã€ŒèŠ‚ç‚¹ã€å­˜å‚¨å­—ç¬¦ä¸²ï¼ˆé”®ï¼‰å¯¹åº”çš„æ•°æ®ï¼ˆå€¼ï¼‰ã€‚æ‰€ä»¥æˆ‘åœ¨å›¾ä¸­æŠŠå­—ç¬¦æ ‡åœ¨æ ‘æï¼Œé”®å¯¹åº”çš„å€¼ `val` æ ‡åœ¨èŠ‚ç‚¹ä¸Š**ï¼š

![img](images/10-20230421211434920.jpeg)

æ˜ç™½è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œæœ‰åŠ©äºä¹‹åä½ ç†è§£ä»£ç å®ç°ã€‚

> PSï¼šã€Šç®—æ³• 4ã€‹ä»¥åŠç½‘ä¸Šè®² Trie æ ‘çš„æ–‡ç« ä¸­éƒ½æ˜¯æŠŠå­—ç¬¦æ ‡åœ¨èŠ‚ç‚¹ä¸Šï¼Œæˆ‘è®¤ä¸ºè¿™æ ·å¾ˆå®¹æ˜“è®©åˆå­¦è€…äº§ç”Ÿè¯¯è§£ï¼Œæ‰€ä»¥å»ºè®®å¤§å®¶æŒ‰ç…§æˆ‘çš„è¿™ç§ç†è§£æ¥è®°å¿† Trie æ ‘ç»“æ„ã€‚

ç°åœ¨ä½ åº”è¯¥çŸ¥é“ä¸ºå•¥ Trie æ ‘ä¹Ÿå«å‰ç¼€æ ‘äº†ï¼Œå› ä¸ºå…¶ä¸­çš„å­—ç¬¦ä¸²å…±äº«å‰ç¼€ï¼Œç›¸åŒå‰ç¼€çš„å­—ç¬¦ä¸²é›†ä¸­åœ¨ Trie æ ‘ä¸­çš„ä¸€ä¸ªå­æ ‘ä¸Šï¼Œç»™å­—ç¬¦ä¸²çš„å¤„ç†å¸¦æ¥å¾ˆå¤§çš„ä¾¿åˆ©ã€‚

### TrieMap/TrieSet API åŠå®ç°

é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹æœ¬æ–‡å®ç°çš„ `TrieMap` çš„ APIï¼Œä¸ºäº†ä¸¾ä¾‹ API çš„åŠŸèƒ½ï¼Œå‡è®¾ TrieMap ä¸­å·²ç»å­˜å‚¨äº†å¦‚ä¸‹é”®å€¼å¯¹ï¼š

![img](images/9.jpeg)

Copy

```java
// åº•å±‚ç”¨ Trie æ ‘å®ç°çš„é”®å€¼æ˜ å°„
// é”®ä¸º String ç±»å‹ï¼Œå€¼ä¸ºç±»å‹ V
class TrieMap<V> {

    /***** å¢/æ”¹ *****/

    // åœ¨ Map ä¸­æ·»åŠ  key
    public void put(String key, V val);

    /***** åˆ  *****/

    // åˆ é™¤é”® key ä»¥åŠå¯¹åº”çš„å€¼
    public void remove(String key);

    /***** æŸ¥ *****/

    // æœç´¢ key å¯¹åº”çš„å€¼ï¼Œä¸å­˜åœ¨åˆ™è¿”å› null
    // get("the") -> 4
    // get("tha") -> null
    public V get(String key);

    // åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨åœ¨ Map ä¸­
    // containsKey("tea") -> false
    // containsKey("team") -> true
    public boolean containsKey(String key);

    // åœ¨ Map çš„æ‰€æœ‰é”®ä¸­æœç´¢ query çš„æœ€çŸ­å‰ç¼€
    // shortestPrefixOf("themxyz") -> "the"
    public String shortestPrefixOf(String query);

    // åœ¨ Map çš„æ‰€æœ‰é”®ä¸­æœç´¢ query çš„æœ€é•¿å‰ç¼€
    // longestPrefixOf("themxyz") -> "them"
    public String longestPrefixOf(String query);

    // æœç´¢æ‰€æœ‰å‰ç¼€ä¸º prefix çš„é”®
    // keysWithPrefix("th") -> ["that", "the", "them"]
    public List<String> keysWithPrefix(String prefix);

    // åˆ¤æ–­æ˜¯å’Œå¦å­˜åœ¨å‰ç¼€ä¸º prefix çš„é”®
    // hasKeyWithPrefix("tha") -> true
    // hasKeyWithPrefix("apple") -> false
    public boolean hasKeyWithPrefix(String prefix);

    // é€šé…ç¬¦ . åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œæœç´¢æ‰€æœ‰åŒ¹é…çš„é”®
    // keysWithPattern("t.a.") -> ["team", "that"]
    public List<String> keysWithPattern(String pattern);

    // é€šé…ç¬¦ . åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨åŒ¹é…çš„é”®
    // hasKeyWithPattern(".ip") -> true
    // hasKeyWithPattern(".i") -> false
    public boolean hasKeyWithPattern(String pattern);

    // è¿”å› Map ä¸­é”®å€¼å¯¹çš„æ•°é‡
    public int size();
}
```

è‡³äº `TrieSet` çš„ API å¤§åŒå°å¼‚ï¼Œæ‰€ä»¥è¿™é‡Œä¸é‡å¤åˆ—ä¸¾ï¼Œåæ–‡ç›´æ¥ç»™å‡ºå®ç°ã€‚

**æ¥ä¸‹æ¥æ˜¯é‡å¤´æˆï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªå®ç° `TrieMap` çš„ä¸Šè¿° API å‡½æ•°**ã€‚

é¦–å…ˆï¼Œ`TrieMap` ç±»ä¸­ä¸€å®šéœ€è¦è®°å½• Trie çš„æ ¹èŠ‚ç‚¹ `root`ï¼Œä»¥åŠ Trie æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹æ•°é‡ç”¨äºå®ç° `size()` æ–¹æ³•ï¼š

Copy

```java
class TrieMap<V> {
    // ASCII ç ä¸ªæ•°
    private static final int R = 256;
    // å½“å‰å­˜åœ¨ Map ä¸­çš„é”®å€¼å¯¹ä¸ªæ•°
    private int size = 0;

    private static class TrieNode<V> {
        V val = null;
        TrieNode<V>[] children = new TrieNode[R];
    }

    // Trie æ ‘çš„æ ¹èŠ‚ç‚¹
    private TrieNode<V> root = null;

    /* å…¶ä»– API çš„å®ç°... */

    public int size() {
        return size;
    }
}
```

å¦å¤–ï¼Œæˆ‘ä»¬å†å®ç°ä¸€ä¸ªå·¥å…·å‡½æ•° `getNode`ï¼š

Copy

```java
// ä»èŠ‚ç‚¹ node å¼€å§‹æœç´¢ keyï¼Œå¦‚æœå­˜åœ¨è¿”å›å¯¹åº”èŠ‚ç‚¹ï¼Œå¦åˆ™è¿”å› null
private TrieNode<V> getNode(TrieNode<V> node, String key) {
    TrieNode<V> p = node;
    // ä»èŠ‚ç‚¹ node å¼€å§‹æœç´¢ key
    for (int i = 0; i < key.length(); i++) {
        if (p == null) {
            // æ— æ³•å‘ä¸‹æœç´¢
            return null;
        }
        // å‘ä¸‹æœç´¢
        char c = key.charAt(i);
        p = p.children[c];
    }
    return p;
}
```

![img](images/11.jpeg)

æœ‰äº†è¿™ä¸ª `getNode` å‡½æ•°ï¼Œå°±èƒ½å®ç° `containsKey` æ–¹æ³•å’Œ `get` æ–¹æ³•äº†ï¼š

Copy

```java
// æœç´¢ key å¯¹åº”çš„å€¼ï¼Œä¸å­˜åœ¨åˆ™è¿”å› null
public V get(String key) {
    // ä» root å¼€å§‹æœç´¢ key
    TrieNode<V> x = getNode(root, key);
    if (x == null || x.val == null) {
        // x ä¸ºç©ºæˆ– x çš„ val å­—æ®µä¸ºç©ºéƒ½è¯´æ˜ key æ²¡æœ‰å¯¹åº”çš„å€¼
        return null;
    }
    return x.val;
}

// åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨åœ¨ Map ä¸­
public boolean containsKey(String key) {
    return get(key) != null;
}
```

**è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå°±ç®— `getNode(key)` çš„è¿”å›å€¼ `x` éç©ºï¼Œä¹Ÿåªèƒ½è¯´å­—ç¬¦ä¸² `key` æ˜¯ä¸€ä¸ªã€Œå‰ç¼€ã€ï¼›é™¤é `x.val` åŒæ—¶éç©ºï¼Œæ‰èƒ½åˆ¤æ–­é”® `key` å­˜åœ¨**ã€‚

ä¸è¿‡ï¼Œè¿™ä¸ªç‰¹æ€§æ°å¥½èƒ½å¤Ÿå¸®æˆ‘ä»¬å®ç° `hasKeyWithPrefix` æ–¹æ³•ï¼š

Copy

```java
// åˆ¤æ–­æ˜¯å’Œå¦å­˜åœ¨å‰ç¼€ä¸º prefix çš„é”®
public boolean hasKeyWithPrefix(String prefix) {
    // åªè¦èƒ½æ‰¾åˆ°ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±æ˜¯å­˜åœ¨å‰ç¼€
    return getNode(root, prefix) != null;
}
```

ç±»ä¼¼ `getNode` æ–¹æ³•çš„é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥å®ç° `shortestPrefixOf` æ–¹æ³•ï¼Œåªè¦åœ¨ç¬¬ä¸€æ¬¡é‡åˆ°å­˜æœ‰ `val` çš„èŠ‚ç‚¹çš„æ—¶å€™è¿”å›å°±è¡Œäº†ï¼š

Copy

```java
// åœ¨æ‰€æœ‰é”®ä¸­å¯»æ‰¾ query çš„æœ€çŸ­å‰ç¼€
public String shortestPrefixOf(String query) {
    TrieNode<V> p = root;
    // ä»èŠ‚ç‚¹ node å¼€å§‹æœç´¢ key
    for (int i = 0; i < query.length(); i++) {
        if (p == null) {
            // æ— æ³•å‘ä¸‹æœç´¢
            return "";
        }
        if (p.val != null) {
            // æ‰¾åˆ°ä¸€ä¸ªé”®æ˜¯ query çš„å‰ç¼€
            return query.substring(0, i);
        }
        // å‘ä¸‹æœç´¢
        char c = query.charAt(i);
        p = p.children[c];
    }

    if (p != null && p.val != null) {
        // å¦‚æœ query æœ¬èº«å°±æ˜¯ä¸€ä¸ªé”®
        return query;
    }
    return "";
}
```

**è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ for å¾ªç¯ç»“æŸä¹‹åæˆ‘ä»¬è¿˜éœ€è¦é¢å¤–æ£€æŸ¥ä¸€ä¸‹**ã€‚

å› ä¸ºä¹‹å‰è¯´äº† Trie æ ‘ä¸­ã€Œæ ‘æã€å­˜å‚¨å­—ç¬¦ä¸²ï¼Œã€ŒèŠ‚ç‚¹ã€å­˜å‚¨å­—ç¬¦ä¸²å¯¹åº”çš„å€¼ï¼Œfor å¾ªç¯ç›¸å½“äºåªéå†äº†ã€Œæ ‘æã€ï¼Œä½†æ¼æ‰äº†æœ€åä¸€ä¸ªã€ŒèŠ‚ç‚¹ã€ï¼Œå³ `query` æœ¬èº«å°±æ˜¯ `TrieMap` ä¸­çš„ä¸€ä¸ªé”®çš„æƒ…å†µã€‚

å¦‚æœä½ ç†è§£äº† `shortestPrefixOf` çš„å®ç°ï¼Œé‚£ä¹ˆ `longestPrefixOf` ä¹Ÿæ˜¯éå¸¸ç±»ä¼¼çš„ï¼š

Copy

```java
// åœ¨æ‰€æœ‰é”®ä¸­å¯»æ‰¾ query çš„æœ€é•¿å‰ç¼€
public String longestPrefixOf(String query) {
    TrieNode<V> p = root;
    // è®°å½•å‰ç¼€çš„æœ€å¤§é•¿åº¦
    int max_len = 0;

    // ä»èŠ‚ç‚¹ node å¼€å§‹æœç´¢ key
    for (int i = 0; i < query.length(); i++) {
        if (p == null) {
            // æ— æ³•å‘ä¸‹æœç´¢
            break;
        }
        if (p.val != null) {
            // æ‰¾åˆ°ä¸€ä¸ªé”®æ˜¯ query çš„å‰ç¼€ï¼Œæ›´æ–°å‰ç¼€çš„æœ€å¤§é•¿åº¦
            max_len = i;
        }
        // å‘ä¸‹æœç´¢
        char c = query.charAt(i);
        p = p.children[c];
    }

    if (p != null && p.val != null) {
        // å¦‚æœ query æœ¬èº«å°±æ˜¯ä¸€ä¸ªé”®
        return query;
    }
    return query.substring(0, max_len);
}
```

æ¯æ¬¡é‡åˆ° `p.val` éç©ºçš„æ—¶å€™è¯´æ˜æ‰¾åˆ°ä¸€ä¸ªé”®ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸æ€¥ç€è¿”å›ï¼Œè€Œæ˜¯æ›´æ–° `max_len` å˜é‡ï¼Œè®°å½•æœ€é•¿å‰ç¼€çš„é•¿åº¦ã€‚

åŒæ ·çš„ï¼Œåœ¨ for å¾ªç¯ç»“æŸæ—¶è¿˜æ˜¯è¦ç‰¹æ®Šåˆ¤æ–­ä¸€ä¸‹ï¼Œå¤„ç† `query` æœ¬èº«å°±æ˜¯é”®çš„æƒ…å†µã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å®ç° `keysWithPrefix` æ–¹æ³•ï¼Œå¾—åˆ°æ‰€æœ‰å‰ç¼€ä¸º `prefix` çš„é”®ã€‚

çœ‹è¿‡å‰æ–‡ [æ‰‹æŠŠæ‰‹åˆ·äºŒå‰æ ‘ï¼ˆæ€»ç»“ç¯‡ï¼‰](https://appktavsiei5995.pc.xiaoe-tech.com/detail/i_63a84ecde4b030cacaff6731/1) çš„è¯»è€…åº”è¯¥å¯ä»¥æƒ³åˆ°ï¼Œå…ˆåˆ©ç”¨ `getNode` å‡½æ•°åœ¨ Trie æ ‘ä¸­æ‰¾åˆ° `prefix` å¯¹åº”çš„èŠ‚ç‚¹ `x`ï¼Œç„¶æ–½å±•å¤šå‰æ ‘çš„éå†ç®—æ³•ï¼Œéå†ä»¥ `x` ä¸ºæ ¹çš„è¿™æ£µ Trie æ ‘ï¼Œæ‰¾åˆ°æ‰€æœ‰é”®å€¼å¯¹ï¼š

![img](images/12.jpeg)

ä»£ç å®ç°å¦‚ä¸‹ï¼š

Copy

```java
// æœç´¢å‰ç¼€ä¸º prefix çš„æ‰€æœ‰é”®
public List<String> keysWithPrefix(String prefix) {
    List<String> res = new LinkedList<>();
    // æ‰¾åˆ°åŒ¹é… prefix åœ¨ Trie æ ‘ä¸­çš„é‚£ä¸ªèŠ‚ç‚¹
    TrieNode<V> x = getNode(root, prefix);
    if (x == null) {
        return res;
    }
    // DFS éå†ä»¥ x ä¸ºæ ¹çš„è¿™æ£µ Trie æ ‘
    traverse(x, new StringBuilder(prefix), res);
    return res;
}

// éå†ä»¥ node èŠ‚ç‚¹ä¸ºæ ¹çš„ Trie æ ‘ï¼Œæ‰¾åˆ°æ‰€æœ‰é”®
private void traverse(TrieNode<V> node, StringBuilder path, List<String> res) {
    if (node == null) {
        // åˆ°è¾¾ Trie æ ‘åº•éƒ¨å¶å­ç»“ç‚¹
        return;
    }

    if (node.val != null) {
        // æ‰¾åˆ°ä¸€ä¸ª keyï¼Œæ·»åŠ åˆ°ç»“æœåˆ—è¡¨ä¸­
        res.add(path.toString());
    }

    // å›æº¯ç®—æ³•éå†æ¡†æ¶
    for (char c = 0; c < R; c++) {
        // åšé€‰æ‹©
        path.append(c);
        traverse(node.children[c], path, res);
        // æ’¤é”€é€‰æ‹©
        path.deleteCharAt(path.length() - 1);
    }
}
```

è¿™æ®µä»£ç ä¸­ `traverse` å‡½æ•°ä½ å¯èƒ½çœ‹èµ·æ¥ç‰¹åˆ«ç†Ÿæ‚‰ï¼Œå°±æ˜¯ [å›æº¯ç®—æ³•æ ¸å¿ƒå¥—è·¯](https://labuladong.github.io/article/fname.html?fname=å›æº¯ç®—æ³•è¯¦è§£ä¿®è®¢ç‰ˆ) ä¸­è®²çš„å›æº¯ç®—æ³•ä»£ç æ¡†æ¶ã€‚

å…³äºå›æº¯ç®—æ³•æ¡†æ¶å’Œæ ‡å‡†å¤šå‰æ ‘æ¡†æ¶çš„åŒºåˆ«æˆ‘åœ¨ [å›¾è®ºç®—æ³•åŸºç¡€](https://labuladong.github.io/article/fname.html?fname=å›¾) ä¸­æ¢è®¨è¿‡ï¼Œå…³é”®åœ¨äºéå†ã€ŒèŠ‚ç‚¹ã€å’Œéå†ã€Œæ ‘æã€çš„åŒºåˆ«ã€‚ç”±äº Trie æ ‘å°†å­—ç¬¦å­˜å‚¨åœ¨ã€Œæ ‘æã€ä¸Šï¼Œ`traverse` å‡½æ•°æ˜¯åœ¨éå†æ ‘æä¸Šçš„å­—ç¬¦ï¼Œæ‰€ä»¥é‡‡ç”¨çš„æ˜¯å›æº¯ç®—æ³•æ¡†æ¶ã€‚

å¦å¤–ï¼Œå†æ³¨æ„ä¸€ä¸‹è¿™æ®µé€»è¾‘ï¼š

Copy

```java
// å›æº¯ç®—æ³•éå†æ¡†æ¶
for (char c = 0; c < R; c++) {
    // åšé€‰æ‹©
    path.append(c);
    traverse(node.children[c], path, res);
    // æ’¤é”€é€‰æ‹©
    path.deleteCharAt(path.length() - 1);
}
```

å›é¡¾ä¸€ä¸‹æˆ‘ä»¬ Trie æ ‘çš„å›¾ï¼š

![img](images/9.jpeg)

ä½ æ˜¯å¦ä¼šæœ‰ç–‘é—®ï¼šä»£ç ä¸­ for å¾ªç¯ä¼šæ‰§è¡Œ 256 æ¬¡ï¼Œä½†æ˜¯å›¾ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹åªæœ‰å‡ ä¸ªå­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªèŠ‚ç‚¹çš„ `children` æ•°ç»„ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯ç©ºæŒ‡é’ˆï¼Œè¿™ä¸ä¼šæœ‰é—®é¢˜å—ï¼Ÿ

æ˜¯ä¸æ˜¯åº”è¯¥æŠŠä»£ç æ”¹æˆè¿™æ ·ï¼š

Copy

```java
// å›æº¯ç®—æ³•éå†æ¡†æ¶
for (char c = 0; c < R; c++) {
    // åšé€‰æ‹©
    path.append(c);
    if (node.children[c] != null) {
        traverse(node.children[c], path, res);
    }
    // æ’¤é”€é€‰æ‹©
    path.deleteCharAt(path.length() - 1);
}
```

ç­”æ¡ˆæ˜¯ï¼Œæ”¹ä¸æ”¹éƒ½è¡Œï¼Œè¿™ä¸¤ç§å†™æ³•ä»é€»è¾‘ä¸Šè®²å®Œå…¨ç›¸åŒï¼Œå› ä¸º `traverse` å‡½æ•°å¼€å§‹çš„æ—¶å€™å¦‚æœå‘ç° `node == null` ä¹Ÿä¼šç›´æ¥è¿”å›ã€‚

æˆ‘ä¸ºäº†ä¿æŒæ¡†æ¶çš„ä¸€è‡´æ€§ï¼Œå°±æ²¡æœ‰åœ¨ for å¾ªç¯ä¸­åˆ¤æ–­å­èŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºï¼Œè€Œæ˜¯ä¾èµ–é€’å½’å‡½æ•°çš„ base caseã€‚å½“ç„¶ä½ å®Œå…¨å¯ä»¥æŒ‰ç…§è‡ªå·±çš„å–œå¥½æ¥å®ç°ã€‚

ä¸‹é¢æ¥å®ç° `keysWithPattern` æ–¹æ³•ï¼Œä½¿ç”¨é€šé…ç¬¦æ¥åŒ¹é…å¤šä¸ªé”®ï¼Œå…¶å…³é”®å°±åœ¨äºé€šé…ç¬¦ `.` å¯ä»¥åŒ¹é…æ‰€æœ‰å­—ç¬¦ã€‚

åœ¨ä»£ç å®ç°ä¸Šï¼Œç”¨ `path` å˜é‡è®°å½•åŒ¹é…é”®çš„è·¯å¾„ï¼Œé‡åˆ°é€šé…ç¬¦æ—¶ä½¿ç”¨ç±»ä¼¼å›æº¯ç®—æ³•çš„æ¡†æ¶å°±è¡Œäº†ï¼š

Copy

```java
// é€šé…ç¬¦ . åŒ¹é…ä»»æ„å­—ç¬¦
public List<String> keysWithPattern(String pattern) {
    List<String> res = new LinkedList<>();
    traverse(root, new StringBuilder(), pattern, 0, res);
    return res;
}

// éå†å‡½æ•°ï¼Œå°è¯•åœ¨ã€Œä»¥ node ä¸ºæ ¹çš„ Trie æ ‘ä¸­ã€åŒ¹é… pattern[i..]
private void traverse(TrieNode<V> node, StringBuilder path, String pattern, int i, List<String> res) {
    if (node == null) {
        // æ ‘æä¸å­˜åœ¨ï¼Œå³å­—ç¬¦ pattern[i-1] åŒ¹é…å¤±è´¥
        return;
    }
    if (i == pattern.length()) {
        // pattern åŒ¹é…å®Œæˆ
        if (node.val != null) {
            // å¦‚æœè¿™ä¸ªèŠ‚ç‚¹å­˜å‚¨ç€ valï¼Œåˆ™æ‰¾åˆ°ä¸€ä¸ªåŒ¹é…çš„é”®
            res.add(path.toString());
        }
        return;
    }
    char c = pattern.charAt(i);
    if (c == '.') {
        // pattern[i] æ˜¯é€šé…ç¬¦ï¼Œå¯ä»¥å˜åŒ–æˆä»»æ„å­—ç¬¦
        // å¤šå‰æ ‘ï¼ˆå›æº¯ç®—æ³•ï¼‰éå†æ¡†æ¶
        for (char j = 0; j < R; j++) {
            path.append(j);
            traverse(node.children[j], path, pattern, i + 1, res);
            path.deleteCharAt(path.length() - 1);
        }
    } else {
        // pattern[i] æ˜¯æ™®é€šå­—ç¬¦ c
        path.append(c);
        traverse(node.children[c], path, pattern, i + 1, res);
        path.deleteCharAt(path.length() - 1);
    }
}
```

ä¸‹é¢è¿™ä¸ª GIF ç”»äº†åŒ¹é… `"t.a."` çš„è¿‡ç¨‹ï¼Œåº”è¯¥å°±å®¹æ˜“ç†è§£ä¸Šè¿°ä»£ç çš„é€»è¾‘äº†ï¼š

![img](images/1-20230421211434937.gif)

å¯ä»¥çœ‹åˆ°ï¼Œ`keysWithPattern` å’Œ `keysWithPrefix` çš„å®ç°æ˜¯æœ‰äº›ç±»ä¼¼çš„ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªå‡½æ•°è¿˜æœ‰ä¸€ä¸ªæ½œåœ¨çš„ç‰¹æ€§ï¼š**å®ƒä»¬è¿”å›çš„ç»“æœåˆ—è¡¨ä¸€å®šæ˜¯ç¬¦åˆã€Œå­—å…¸åºã€çš„**ã€‚

åŸå› åº”è¯¥ä¸éš¾ç†è§£ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹çš„ `children` æ•°ç»„éƒ½æ˜¯ä»å·¦åˆ°å³è¿›è¡Œéå†ï¼Œå³æŒ‰ç…§ ASCII ç ä»å°åˆ°å¤§çš„é¡ºåºé€’å½’éå†ï¼Œå¾—åˆ°çš„ç»“æœè‡ªç„¶æ˜¯ç¬¦åˆå­—å…¸åºçš„ã€‚

å¥½ï¼Œç°åœ¨æˆ‘ä»¬å®ç°äº† `keysWithPattern` æ–¹æ³•å¾—åˆ°æ¨¡å¼ä¸²åŒ¹é…çš„æ‰€æœ‰é”®ï¼Œé‚£ä½ æ˜¯å¦å¯ä»¥å®ç° `hasKeyWithPattern` æ–¹æ³•ï¼Œä»…ä»…åˆ¤æ–­æ˜¯å¦å­˜åœ¨é”®åŒ¹é…æ¨¡å¼ä¸²ï¼Ÿ

Copy

```java
// ä¸€ä¸ªå·æ‡’çš„å®ç°
public boolean hasKeyWithPattern(String pattern) {
    return !keysWithPattern(pattern).isEmpty();
}
```

è¿™æ˜¯ä¸€ä¸ªå·æ‡’çš„å®ç°ï¼Œå› ä¸ºå®ƒçš„å¤æ‚åº¦æ¯”è¾ƒé«˜ã€‚æˆ‘ä»¬çš„ç›®çš„ä»…ä»…æ˜¯åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŒ¹é…æ¨¡å¼ä¸²çš„é”®ï¼Œä½ å´æŠŠæ‰€æœ‰åŒ¹é…çš„é”®éƒ½ç®—å‡ºæ¥äº†ï¼Œè¿™æ˜¾ç„¶æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚

æˆ‘ä»¬åªéœ€ç¨å¾®æ”¹å†™ä¸€ä¸‹ `keysWithPattern` æ–¹æ³•å°±å¯ä»¥é«˜æ•ˆå®ç° `hasKeyWithPattern` æ–¹æ³•ï¼š

Copy

```java
// åˆ¤æ–­æ˜¯å’Œå¦å­˜åœ¨å‰ç¼€ä¸º prefix çš„é”®
public boolean hasKeyWithPattern(String pattern) {
    // ä» root èŠ‚ç‚¹å¼€å§‹åŒ¹é… pattern[0..]
    return hasKeyWithPattern(root, pattern, 0);
}

// å‡½æ•°å®šä¹‰ï¼šä» node èŠ‚ç‚¹å¼€å§‹åŒ¹é… pattern[i..]ï¼Œè¿”å›æ˜¯å¦æˆåŠŸåŒ¹é…
private boolean hasKeyWithPattern(TrieNode<V> node, String pattern, int i) {
    if (node == null) {
        // æ ‘æä¸å­˜åœ¨ï¼Œå³åŒ¹é…å¤±è´¥
        return false;
    }
    if (i == pattern.length()) {
        // æ¨¡å¼ä¸²èµ°åˆ°å¤´äº†ï¼Œçœ‹çœ‹åŒ¹é…åˆ°çš„æ˜¯å¦æ˜¯ä¸€ä¸ªé”®
        return node.val != null;
    }
    char c = pattern.charAt(i);
    // æ²¡æœ‰é‡åˆ°é€šé…ç¬¦
    if (c != '.') {
        // ä» node.children[c] èŠ‚ç‚¹å¼€å§‹åŒ¹é… pattern[i+1..]
        return hasKeyWithPattern(node.children[c], pattern, i + 1);
    }
    // é‡åˆ°é€šé…ç¬¦
    for (int j = 0; j < R; j++) {
        // pattern[i] å¯ä»¥å˜åŒ–æˆä»»æ„å­—ç¬¦ï¼Œå°è¯•æ‰€æœ‰å¯èƒ½ï¼Œåªè¦é‡åˆ°ä¸€ä¸ªåŒ¹é…æˆåŠŸå°±è¿”å›
        if (hasKeyWithPattern(node.children[j], pattern, i + 1)) {
            return true;
        }
    }
    // éƒ½æ²¡æœ‰åŒ¹é…
    return false;
}
```

æœ‰ä¹‹å‰çš„é“ºå«ï¼Œè¿™ä¸ªå®ç°åº”è¯¥æ˜¯ä¸éš¾ç†è§£çš„ï¼Œç±»ä¼¼äº [å›æº¯ç®—æ³•è§£æ•°ç‹¬æ¸¸æˆ](https://labuladong.github.io/article/fname.html?fname=sudoku) ä¸­æ‰¾åˆ°ä¸€ä¸ªå¯è¡Œè§£å°±æå‰ç»“æŸé€’å½’çš„åšæ³•ã€‚

åˆ°è¿™é‡Œï¼Œ`TrieMap` çš„æ‰€æœ‰å’Œå‰ç¼€ç›¸å…³çš„æ–¹æ³•éƒ½å®ç°å®Œäº†ï¼Œè¿˜å‰©ä¸‹ `put` å’Œ `remove` è¿™ä¸¤ä¸ªåŸºæœ¬æ–¹æ³•äº†ï¼Œå…¶å®å®ƒä»¬çš„éš¾åº¦ä¸å¤§ï¼Œå°±æ˜¯é€’å½’ä¿®æ”¹æ•°æ®ç»“æ„çš„é‚£ä¸€å¥—ï¼Œå¦‚æœä¸ç†Ÿæ‚‰çš„è¯å¯ä»¥å‚è§ [äºŒå‰æœç´¢æ ‘åŸºæœ¬æ“ä½œ](https://appktavsiei5995.pc.xiaoe-tech.com/detail/i_63a84fb7e4b07b0558298a07/1)ã€‚

å…ˆè¯´ `put` æ–¹æ³•çš„å®ç°å§ï¼Œç›´æ¥çœ‹ä»£ç ï¼š

Copy

```java
// åœ¨ map ä¸­æ·»åŠ æˆ–ä¿®æ”¹é”®å€¼å¯¹
public void put(String key, V val) {
    if (!containsKey(key)) {
        // æ–°å¢é”®å€¼å¯¹
        size++;
    }
    // éœ€è¦ä¸€ä¸ªé¢å¤–çš„è¾…åŠ©å‡½æ•°ï¼Œå¹¶æ¥æ”¶å…¶è¿”å›å€¼
    root = put(root, key, val, 0);
}

// å®šä¹‰ï¼šå‘ä»¥ node ä¸ºæ ¹çš„ Trie æ ‘ä¸­æ’å…¥ key[i..]ï¼Œè¿”å›æ’å…¥å®Œæˆåçš„æ ¹èŠ‚ç‚¹
private TrieNode<V> put(TrieNode<V> node, String key, V val, int i) {
    if (node == null) {
        // å¦‚æœæ ‘æä¸å­˜åœ¨ï¼Œæ–°å»º
        node = new TrieNode<>();
    }
    if (i == key.length()) {
        // key çš„è·¯å¾„å·²æ’å…¥å®Œæˆï¼Œå°†å€¼ val å­˜å…¥èŠ‚ç‚¹
        node.val = val;
        return node;
    }
    char c = key.charAt(i);
    // é€’å½’æ’å…¥å­èŠ‚ç‚¹ï¼Œå¹¶æ¥æ”¶è¿”å›å€¼
    node.children[c] = put(node.children[c], key, val, i + 1);
    return node;
}
```

å› ä¸ºæ˜¯é€’å½’ä¿®æ”¹æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»é¢å¤–åˆ›å»ºä¸€ä¸ªè¿”å›ç±»å‹ä¸º `TrieNode` çš„è¾…åŠ©å‡½æ•°ï¼Œå¹¶ä¸”åœ¨é€’å½’è°ƒç”¨çš„æ—¶å€™æ¥æ”¶å…¶è¿”å›å€¼ï¼Œæ‹¼æ¥åˆ°çˆ¶èŠ‚ç‚¹ä¸Šã€‚

**å‰æ–‡è¯´äº†ï¼ŒTrie æ ‘ä¸­çš„é”®å°±æ˜¯ã€Œæ ‘æã€ï¼Œå€¼å°±æ˜¯ã€ŒèŠ‚ç‚¹ã€ï¼Œæ‰€ä»¥æ’å…¥çš„é€»è¾‘å°±æ˜¯æ²¿è·¯æ–°å»ºã€Œæ ‘æã€ï¼ŒæŠŠ `key` çš„æ•´æ¡ã€Œæ ‘æã€æ„å»ºå‡ºæ¥ä¹‹åï¼Œåœ¨æ ‘ææœ«ç«¯çš„ã€ŒèŠ‚ç‚¹ã€ä¸­å­˜å‚¨ `val`**ï¼š

![img](images/2.gif)

æœ€åï¼Œæˆ‘ä»¬è¯´ä¸€ä¸‹ `remove` å‡½æ•°ï¼Œä¼¼ä¹æ‰€æœ‰æ•°æ®ç»“æ„çš„åˆ é™¤æ“ä½œç›¸å¯¹å…¶ä»–æ“ä½œéƒ½ä¼šæ›´å¤æ‚ä¸€äº›ã€‚

æ¯”å¦‚è¯´ä¸‹å›¾è¿™ä¸ªåœºæ™¯ï¼Œå¦‚æœä½ æƒ³åˆ é™¤é”® `"team"`ï¼Œé‚£ä¹ˆéœ€è¦åˆ æ‰ `"eam"` è¿™æ¡æ ‘ææ‰æ˜¯ç¬¦åˆé€»è¾‘çš„ï¼š

![img](images/13.jpeg)

åˆ å¤šäº†è‚¯å®šä¸è¡Œï¼Œä½†åˆ å°‘äº†ä¹Ÿä¸è¡Œï¼Œå¦åˆ™å‰æ–‡å®ç°çš„ `hasKeyWithPrefix` å°±ä¼šå‡ºé”™ã€‚

é‚£ä¹ˆå¦‚ä½•æ§åˆ¶ç®—æ³•æ¥æ­£ç¡®åœ°è¿›è¡Œåˆ é™¤å‘¢ï¼Ÿ

é¦–å…ˆï¼Œé€’å½’ä¿®æ”¹æ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹æƒ³åˆ æ‰è‡ªå·±ï¼Œç›´æ¥è¿”å›ç©ºæŒ‡é’ˆå°±è¡Œäº†ã€‚

**å…¶æ¬¡ï¼Œä¸€ä¸ªèŠ‚ç‚¹å¦‚ä½•çŸ¥é“è‡ªå·±æ˜¯å¦éœ€è¦è¢«åˆ é™¤å‘¢ï¼Ÿä¸»è¦çœ‹è‡ªå·±çš„ `val` å­—æ®µæ˜¯å¦ä¸ºç©ºä»¥åŠè‡ªå·±çš„ `children` æ•°ç»„æ˜¯å¦å…¨éƒ½æ˜¯ç©ºæŒ‡é’ˆ**ã€‚

è¿™é‡Œå°±è¦åˆ©ç”¨å‰æ–‡ [æ‰‹æŠŠæ‰‹åˆ·äºŒå‰æ ‘ï¼ˆæ€»ç»“ç¯‡ï¼‰](https://appktavsiei5995.pc.xiaoe-tech.com/detail/i_63a84ecde4b030cacaff6731/1) ä¸­è¯´åˆ°çš„ååºä½ç½®çš„ç‰¹ç‚¹äº†ï¼š

ä¸€ä¸ªèŠ‚ç‚¹è¦å…ˆé€’å½’å¤„ç†å­æ ‘ï¼Œç„¶ååœ¨ååºä½ç½®æ£€æŸ¥è‡ªå·±çš„ `val` å­—æ®µå’Œ `children` åˆ—è¡¨ï¼Œåˆ¤æ–­è‡ªå·±æ˜¯å¦éœ€è¦è¢«åˆ é™¤ã€‚

å¦‚æœè‡ªå·±çš„ `val` å­—æ®µä¸ºç©ºï¼Œè¯´æ˜è‡ªå·±æ²¡æœ‰å­˜å‚¨å€¼ï¼Œå¦‚æœåŒæ—¶è‡ªå·±çš„ `children` æ•°ç»„å…¨æ˜¯ç©ºæŒ‡é’ˆï¼Œè¯´æ˜è‡ªå·±ä¸‹é¢ä¹Ÿæ²¡æœ‰æ¥æ ‘æï¼Œå³ä¸æ˜¯ä»»ä½•ä¸€ä¸ªé”®çš„å‰ç¼€ã€‚è¿™ç§æƒ…å†µä¸‹è¿™ä¸ªèŠ‚ç‚¹å°±æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†ï¼Œåº”è¯¥åˆ æ‰è‡ªå·±ã€‚

ç›´æ¥çœ‹ä»£ç ï¼š

Copy

```java
// åœ¨ Map ä¸­åˆ é™¤ key
public void remove(String key) {
    if (!containsKey(key)) {
        return;
    }
    // é€’å½’ä¿®æ”¹æ•°æ®ç»“æ„è¦æ¥æ”¶å‡½æ•°çš„è¿”å›å€¼
    root = remove(root, key, 0);
    size--;
}

// å®šä¹‰ï¼šåœ¨ä»¥ node ä¸ºæ ¹çš„ Trie æ ‘ä¸­åˆ é™¤ key[i..]ï¼Œè¿”å›åˆ é™¤åçš„æ ¹èŠ‚ç‚¹
private TrieNode<V> remove(TrieNode<V> node, String key, int i) {
    if (node == null) {
        return null;
    }
    if (i == key.length()) {
        // æ‰¾åˆ°äº† key å¯¹åº”çš„ TrieNodeï¼Œåˆ é™¤ val
        node.val = null;
    } else {
        char c = key.charAt(i);
        // é€’å½’å»å­æ ‘è¿›è¡Œåˆ é™¤
        node.children[c] = remove(node.children[c], key, i + 1);
    }
    // ååºä½ç½®ï¼Œé€’å½’è·¯å¾„ä¸Šçš„èŠ‚ç‚¹å¯èƒ½éœ€è¦è¢«æ¸…ç†
    if (node.val != null) {
        // å¦‚æœè¯¥ TireNode å­˜å‚¨ç€ valï¼Œä¸éœ€è¦è¢«æ¸…ç†
        return node;
    }
    // æ£€æŸ¥è¯¥ TrieNode æ˜¯å¦è¿˜æœ‰åç¼€
    for (int c = 0; c < R; c++) {
        if (node.children[c] != null) {
            // åªè¦å­˜åœ¨ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆåç¼€æ ‘æï¼‰ï¼Œå°±ä¸éœ€è¦è¢«æ¸…ç†
            return node;
        }
    }
    // æ—¢æ²¡æœ‰å­˜å‚¨ valï¼Œä¹Ÿæ²¡æœ‰åç¼€æ ‘æï¼Œåˆ™è¯¥èŠ‚ç‚¹éœ€è¦è¢«æ¸…ç†
    return null;
}
```

åˆ°è¿™é‡Œï¼Œ`TrieMap` çš„æ‰€æœ‰ API å°±å®ç°å®Œäº†ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

Copy

```java
class TrieMap<V> {
    // ASCII ç ä¸ªæ•°
    private static final int R = 256;
    // å½“å‰å­˜åœ¨ Map ä¸­çš„é”®å€¼å¯¹ä¸ªæ•°
    private int size = 0;
    // Trie æ ‘çš„æ ¹èŠ‚ç‚¹
    private TrieNode<V> root = null;

    private static class TrieNode<V> {
        V val = null;
        TrieNode<V>[] children = new TrieNode[R];
    }

    /***** å¢/æ”¹ *****/

    // åœ¨ map ä¸­æ·»åŠ æˆ–ä¿®æ”¹é”®å€¼å¯¹
    public void put(String key, V val) {
        if (!containsKey(key)) {
            // æ–°å¢é”®å€¼å¯¹
            size++;
        }
        // éœ€è¦ä¸€ä¸ªé¢å¤–çš„è¾…åŠ©å‡½æ•°ï¼Œå¹¶æ¥æ”¶å…¶è¿”å›å€¼
        root = put(root, key, val, 0);
    }

    // å®šä¹‰ï¼šå‘ä»¥ node ä¸ºæ ¹çš„ Trie æ ‘ä¸­æ’å…¥ key[i..]ï¼Œè¿”å›æ’å…¥å®Œæˆåçš„æ ¹èŠ‚ç‚¹
    private TrieNode<V> put(TrieNode<V> node, String key, V val, int i) {
        if (node == null) {            


            // å¦‚æœæ ‘æä¸å­˜åœ¨ï¼Œæ–°å»º
            node = new TrieNode<>();
        }
        if (i == key.length()) {
            // key çš„è·¯å¾„å·²æ’å…¥å®Œæˆï¼Œå°†å€¼ val å­˜å…¥èŠ‚ç‚¹
            node.val = val;
            return node;
        }
        char c = key.charAt(i);
        // é€’å½’æ’å…¥å­èŠ‚ç‚¹ï¼Œå¹¶æ¥æ”¶è¿”å›å€¼
        node.children[c] = put(node.children[c], key, val, i + 1);
        return node;
    }

    /***** åˆ  *****/

    // åœ¨ Map ä¸­åˆ é™¤ key
    public void remove(String key) {
        if (!containsKey(key)) {
            return;
        }
        // é€’å½’ä¿®æ”¹æ•°æ®ç»“æ„è¦æ¥æ”¶å‡½æ•°çš„è¿”å›å€¼
        root = remove(root, key, 0);
        size--;
    }

    // å®šä¹‰ï¼šåœ¨ä»¥ node ä¸ºæ ¹çš„ Trie æ ‘ä¸­åˆ é™¤ key[i..]ï¼Œè¿”å›åˆ é™¤åçš„æ ¹èŠ‚ç‚¹
    private TrieNode<V> remove(TrieNode<V> node, String key, int i) {
        if (node == null) {
            return null;
        }
        if (i == key.length()) {
            // æ‰¾åˆ°äº† key å¯¹åº”çš„ TrieNodeï¼Œåˆ é™¤ val
            node.val = null;
        } else {
            char c = key.charAt(i);
            // é€’å½’å»å­æ ‘è¿›è¡Œåˆ é™¤
            node.children[c] = remove(node.children[c], key, i + 1);
        }        


        // ååºä½ç½®ï¼Œé€’å½’è·¯å¾„ä¸Šçš„èŠ‚ç‚¹å¯èƒ½éœ€è¦è¢«æ¸…ç†
        if (node.val != null) {
            // å¦‚æœè¯¥ TireNode å­˜å‚¨ç€ valï¼Œä¸éœ€è¦è¢«æ¸…ç†
            return node;
        }
        // æ£€æŸ¥è¯¥ TrieNode æ˜¯å¦è¿˜æœ‰åç¼€
        for (int c = 0; c < R; c++) {
            if (node.children[c] != null) {
                // åªè¦å­˜åœ¨ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆåç¼€æ ‘æï¼‰ï¼Œå°±ä¸éœ€è¦è¢«æ¸…ç†
                return node;
            }
        }
        // æ—¢æ²¡æœ‰å­˜å‚¨ valï¼Œä¹Ÿæ²¡æœ‰åç¼€æ ‘æï¼Œåˆ™è¯¥èŠ‚ç‚¹éœ€è¦è¢«æ¸…ç†
        return null;
    }

    /***** æŸ¥ *****/

    // æœç´¢ key å¯¹åº”çš„å€¼ï¼Œä¸å­˜åœ¨åˆ™è¿”å› null
    public V get(String key) {
        // ä» root å¼€å§‹æœç´¢ key
        TrieNode<V> x = getNode(root, key);
        if (x == null || x.val == null) {
            // x ä¸ºç©ºæˆ– x çš„ val å­—æ®µä¸ºç©ºéƒ½è¯´æ˜ key æ²¡æœ‰å¯¹åº”çš„å€¼
            return null;
        }
        return x.val;
    }

    // åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨åœ¨ Map ä¸­
    public boolean containsKey(String key) {
        return get(key) != null;
    }

    // åˆ¤æ–­æ˜¯å’Œå¦å­˜åœ¨å‰ç¼€ä¸º prefix çš„é”®
    public boolean hasKeyWithPrefix(String prefix) {
        // åªè¦èƒ½æ‰¾åˆ°ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±æ˜¯å­˜åœ¨å‰ç¼€
        return getNode(root, prefix) != null;
    }

    // åœ¨æ‰€æœ‰é”®ä¸­å¯»æ‰¾ query çš„æœ€çŸ­å‰ç¼€
    public String shortestPrefixOf(String query) {
        TrieNode<V> p = root;
        // ä»èŠ‚ç‚¹ node å¼€å§‹æœç´¢ key
        for (int i = 0; i < query.length(); i++) {
            if (p == null) {
                // æ— æ³•å‘ä¸‹æœç´¢
                return "";
            }
            if (p.val != null) {
                // æ‰¾åˆ°ä¸€ä¸ªé”®æ˜¯ query çš„å‰ç¼€
                return query.substring(0, i);
            }
            // å‘ä¸‹æœç´¢
            char c = query.charAt(i);
            p = p.children[c];
        }

        if (p != null && p.val != null) {
            // å¦‚æœ query æœ¬èº«å°±æ˜¯ä¸€ä¸ªé”®
            return query;
        }
        return "";
    }

    // åœ¨æ‰€æœ‰é”®ä¸­å¯»æ‰¾ query çš„æœ€é•¿å‰ç¼€
    public String longestPrefixOf(String query) {
        TrieNode<V> p = root;
        // è®°å½•å‰ç¼€çš„æœ€å¤§é•¿åº¦
        int max_len = 0;

        // ä»èŠ‚ç‚¹ node å¼€å§‹æœç´¢ key
        for (int i = 0; i < query.length(); i++) {
            if (p == null) {
                // æ— æ³•å‘ä¸‹æœç´¢
                break;
            }
            if (p.val != null) {
                // æ‰¾åˆ°ä¸€ä¸ªé”®æ˜¯ query çš„å‰ç¼€ï¼Œæ›´æ–°å‰ç¼€çš„æœ€å¤§é•¿åº¦
                max_len = i;
            }
            // å‘ä¸‹æœç´¢
            char c = query.charAt(i);
            p = p.children[c];
        }

        if (p != null && p.val != null) {
            // å¦‚æœ query æœ¬èº«å°±æ˜¯ä¸€ä¸ªé”®
            return query;
        }
        return query.substring(0, max_len);
    }

    // æœç´¢å‰ç¼€ä¸º prefix çš„æ‰€æœ‰é”®
    public List<String> keysWithPrefix(String prefix) {
        List<String> res = new LinkedList<>();
        // æ‰¾åˆ°åŒ¹é… prefix åœ¨ Trie æ ‘ä¸­çš„é‚£ä¸ªèŠ‚ç‚¹
        TrieNode<V> x = getNode(root, prefix);        


        if (x == null) {
            return res;
        }
        // DFS éå†ä»¥ x ä¸ºæ ¹çš„è¿™æ£µ Trie æ ‘
        traverse(x, new StringBuilder(prefix), res);
        return res;
    }

    // éå†ä»¥ node èŠ‚ç‚¹ä¸ºæ ¹çš„ Trie æ ‘ï¼Œæ‰¾åˆ°æ‰€æœ‰é”®
    private void traverse(TrieNode<V> node, StringBuilder path, List<String> res) {
        if (node == null) {
            // åˆ°è¾¾ Trie æ ‘åº•éƒ¨å¶å­ç»“ç‚¹
            return;
        }

        if (node.val != null) {
            // æ‰¾åˆ°ä¸€ä¸ª keyï¼Œæ·»åŠ åˆ°ç»“æœåˆ—è¡¨ä¸­
            res.add(path.toString());
        }

        // å›æº¯ç®—æ³•éå†æ¡†æ¶
        for (char c = 0; c < R; c++) {
            // åšé€‰æ‹©
            path.append(c);
            traverse(node.children[c], path, res);
            // æ’¤é”€é€‰æ‹©
            path.deleteCharAt(path.length() - 1);
        }
    }

    // é€šé…ç¬¦ . åŒ¹é…ä»»æ„å­—ç¬¦
    public List<String> keysWithPattern(String pattern) {
        List<String> res = new LinkedList<>();
        traverse(root, new StringBuilder(), pattern, 0, res);
        return res;
    }

    // éå†å‡½æ•°ï¼Œå°è¯•åœ¨ã€Œä»¥ node ä¸ºæ ¹çš„ Trie æ ‘ä¸­ã€åŒ¹é… pattern[i..]
    private void traverse(TrieNode<V> node, StringBuilder path, String pattern, int i, List<String> res) {
        if (node == null) {
            // æ ‘æä¸å­˜åœ¨ï¼Œå³åŒ¹é…å¤±è´¥
            return;
        }
        if (i == pattern.length()) {
            // pattern åŒ¹é…å®Œæˆ
            if (node.val != null) {
                // å¦‚æœè¿™ä¸ªèŠ‚ç‚¹å­˜å‚¨ç€ valï¼Œåˆ™æ‰¾åˆ°ä¸€ä¸ªåŒ¹é…çš„é”®
                res.add(path.toString());
            }
            return;
        }
        char c = pattern.charAt(i);        


        if (c == '.') {
            // pattern[i] æ˜¯é€šé…ç¬¦ï¼Œå¯ä»¥å˜åŒ–æˆä»»æ„å­—ç¬¦
            // å¤šå‰æ ‘ï¼ˆå›æº¯ç®—æ³•ï¼‰éå†æ¡†æ¶
            for (char j = 0; j < R; j++) {
                path.append(j);
                traverse(node.children[j], path, pattern, i + 1, res);
                path.deleteCharAt(path.length() - 1);
            }
        } else {
            // pattern[i] æ˜¯æ™®é€šå­—ç¬¦ c
            path.append(c);
            traverse(node.children[c], path, pattern, i + 1, res);
            path.deleteCharAt(path.length() - 1);
        }
    }

    // åˆ¤æ–­æ˜¯å’Œå¦å­˜åœ¨å‰ç¼€ä¸º prefix çš„é”®
    public boolean hasKeyWithPattern(String pattern) {
        // ä» root èŠ‚ç‚¹å¼€å§‹åŒ¹é… pattern[0..]
        return hasKeyWithPattern(root, pattern, 0);
    }

    // å‡½æ•°å®šä¹‰ï¼šä» node èŠ‚ç‚¹å¼€å§‹åŒ¹é… pattern[i..]ï¼Œè¿”å›æ˜¯å¦æˆåŠŸåŒ¹é…
    private boolean hasKeyWithPattern(TrieNode<V> node, String pattern, int i) {
        if (node == null) {
            // æ ‘æä¸å­˜åœ¨ï¼Œå³åŒ¹é…å¤±è´¥
            return false;
        }
        if (i == pattern.length()) {
            // æ¨¡å¼ä¸²èµ°åˆ°å¤´äº†ï¼Œçœ‹çœ‹åŒ¹é…åˆ°çš„æ˜¯å¦æ˜¯ä¸€ä¸ªé”®
            return node.val != null;
        }
        char c = pattern.charAt(i);
        // æ²¡æœ‰é‡åˆ°é€šé…ç¬¦
        if (c != '.') {
            // ä» node.children[c] èŠ‚ç‚¹å¼€å§‹åŒ¹é… pattern[i+1..]
            return hasKeyWithPattern(node.children[c], pattern, i + 1);
        }
        // é‡åˆ°é€šé…ç¬¦
        for (int j = 0; j < R; j++) {
            // pattern[i] å¯ä»¥å˜åŒ–æˆä»»æ„å­—ç¬¦ï¼Œå°è¯•æ‰€æœ‰å¯èƒ½ï¼Œåªè¦é‡åˆ°ä¸€ä¸ªåŒ¹é…æˆåŠŸå°±è¿”å›
            if (hasKeyWithPattern(node.children[j], pattern, i + 1)) {
                return true;
            }
        }
        // éƒ½æ²¡æœ‰åŒ¹é…
        return false;
    }

    // ä»èŠ‚ç‚¹ node å¼€å§‹æœç´¢ keyï¼Œå¦‚æœå­˜åœ¨è¿”å›å¯¹åº”èŠ‚ç‚¹ï¼Œå¦åˆ™è¿”å› null
    private TrieNode<V> getNode(TrieNode<V> node, String key) {        


        TrieNode<V> p = node;
        // ä»èŠ‚ç‚¹ node å¼€å§‹æœç´¢ key
        for (int i = 0; i < key.length(); i++) {
            if (p == null) {
                // æ— æ³•å‘ä¸‹æœç´¢
                return null;
            }
            // å‘ä¸‹æœç´¢
            char c = key.charAt(i);
            p = p.children[c];
        }
        return p;
    }

    public int size() {
        return size;
    }
}
```

æ¥ä¸‹æ¥æˆ‘ä»¬åªè¦å¯¹ `TrieMap` åšç®€å•çš„å°è£…ï¼Œå³å¯å®ç° `TrieSet`ï¼š

Copy

```java
class TrieSet {
    // åº•å±‚ç”¨ä¸€ä¸ª TrieMapï¼Œé”®å°±æ˜¯ TrieSetï¼Œå€¼ä»…ä»…èµ·åˆ°å ä½çš„ä½œç”¨
    // å€¼çš„ç±»å‹å¯ä»¥éšä¾¿è®¾ç½®ï¼Œæˆ‘å‚è€ƒ Java æ ‡å‡†åº“è®¾ç½®æˆ Object
    private final TrieMap<Object> map = new TrieMap<>();

    /***** å¢ *****/

    // åœ¨é›†åˆä¸­æ·»åŠ å…ƒç´  key
    public void add(String key) {
        map.put(key, new Object());
    }

    /***** åˆ  *****/

    // ä»é›†åˆä¸­åˆ é™¤å…ƒç´  key
    public void remove(String key) {
        map.remove(key);
    }

    /***** æŸ¥ *****/

    // åˆ¤æ–­å…ƒç´  key æ˜¯å¦å­˜åœ¨é›†åˆä¸­
    public boolean contains(String key) {
        return map.containsKey(key);
    }

    // åœ¨é›†åˆä¸­å¯»æ‰¾ query çš„æœ€çŸ­å‰ç¼€
    public String shortestPrefixOf(String query) {
        return map.shortestPrefixOf(query);
    }

    // åœ¨é›†åˆä¸­å¯»æ‰¾ query çš„æœ€é•¿å‰ç¼€
    public String longestPrefixOf(String query) {
        return map.longestPrefixOf(query);
    }

    // åœ¨é›†åˆä¸­æœç´¢å‰ç¼€ä¸º prefix çš„æ‰€æœ‰å…ƒç´ 
    public List<String> keysWithPrefix(String prefix) {
        return map.keysWithPrefix(prefix);
    }

    // åˆ¤æ–­é›†åˆä¸­æ˜¯å¦å­˜åœ¨å‰ç¼€ä¸º prefix çš„å…ƒç´ 
    public boolean hasKeyWithPrefix(String prefix) {
        return map.hasKeyWithPrefix(prefix);
    }

    // é€šé…ç¬¦ . åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œè¿”å›é›†åˆä¸­åŒ¹é… pattern çš„æ‰€æœ‰å…ƒç´ 
    public List<String> keysWithPattern(String pattern) {
        return map.keysWithPattern(pattern);
    }

    // é€šé…ç¬¦ . åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œåˆ¤æ–­é›†åˆä¸­æ˜¯å¦å­˜åœ¨åŒ¹é… pattern çš„å…ƒç´ 
    public boolean hasKeyWithPattern(String pattern) {
        return map.hasKeyWithPattern(pattern);
    }

    // è¿”å›é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°
    public int size() {
        return map.size();
    }
}
```

**æœ‰äº† `TrieMap` å’Œ `TrieSet`ï¼ŒåŠ›æ‰£ä¸Šæ‰€æœ‰å‰ç¼€æ ‘ç›¸å…³çš„é¢˜ç›®éƒ½å¯ä»¥ç›´æ¥å¥—ç”¨äº†**ï¼Œä¸‹é¢æˆ‘ä¸¾å‡ ä¸ªé¢˜ç›®å®è·µä¸€ä¸‹ã€‚

### ç§’æ€é¢˜ç›®

**é¦–å…ˆéœ€è¦è¯´æ˜ï¼Œä¸Šæ–‡å®ç°çš„ç®—æ³•æ¨¡æ¿çš„æ‰§è¡Œæ•ˆç‡åœ¨å…·ä½“çš„é¢˜ç›®é‡Œé¢è‚¯å®šæ˜¯æœ‰ä¼˜åŒ–ç©ºé—´çš„**ã€‚

æ¯”å¦‚åŠ›æ‰£å‰ç¼€æ ‘ç›¸å…³é¢˜ç›®çš„è¾“å…¥éƒ½è¢«é™åˆ¶åœ¨å°å†™è‹±æ–‡å­—æ¯ `a-z`ï¼Œæ‰€ä»¥ `TrieNode` å…¶å®ä¸ç”¨ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º 256 çš„ `children` æ•°ç»„ï¼Œå¤§å°è®¾ç½®ä¸º 26 å°±å¤Ÿäº†ï¼Œå¯ä»¥å‡å°æ—¶é—´å’Œç©ºé—´ä¸Šçš„å¤æ‚åº¦ã€‚

ä¸è¿‡æœ¬æ–‡åªè€ƒè™‘æ¨¡æ¿çš„é€šç”¨æ€§ï¼Œé‡åœ¨æ€è·¯ï¼Œæ‰€ä»¥å°±ç›´æ¥å¥—ç”¨ä¸Šæ–‡ç»™å‡ºçš„ç®—æ³•æ¨¡æ¿è§£é¢˜ï¼Œå…·ä½“å®ç°ä¸Šçš„ç»†èŠ‚ä¼˜åŒ–æˆ‘é›†æˆåœ¨ [åˆ·é¢˜æ’ä»¶](https://mp.weixin.qq.com/s/uOubir_nLzQtp_fWHL73JA) çš„ã€Œæ€è·¯ã€æŒ‰é’®ä¸­ã€‚

å…ˆçœ‹ä¸‹åŠ›æ‰£ç¬¬ 208 é¢˜ã€Œå®ç°å‰ç¼€æ ‘ã€ï¼š

![img](images/title1-20230421211434938.png)

é¢˜ç›®è®©æˆ‘ä»¬å®ç°çš„å‡ ä¸ªå‡½æ•°å…¶å®å°±æ˜¯ `TrieSet` çš„éƒ¨åˆ† APIï¼Œæ‰€ä»¥ç›´æ¥å°è£…ä¸€ä¸ª `TrieSet` å°±èƒ½è§£å†³è¿™é“é¢˜äº†ï¼š

Copy

```java
class Trie {
    // ç›´æ¥å°è£… TrieSet
    TrieSet set = new TrieSet();

    // æ’å…¥ä¸€ä¸ªå…ƒç´ 
    public void insert(String word) {
        set.add(word);
    }

    // åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­
    public boolean search(String word) {
        return set.contains(word);
    }

    // åˆ¤æ–­é›†åˆä¸­æ˜¯å¦æœ‰å‰ç¼€ä¸º prefix çš„å…ƒç´ 
    public boolean startsWith(String prefix) {
        return set.hasKeyWithPrefix(prefix);
    }
}

class TrieSet { /* è§ä¸Šæ–‡ */ }

class TrieMap { /* è§ä¸Šæ–‡ */ }
```

æ¥ä¸‹æ¥çœ‹ä¸‹åŠ›æ‰£ç¬¬ 648 é¢˜ã€Œå•è¯æ›¿æ¢ã€ï¼š

![img](images/title2-20230421211434944.png)

ç°åœ¨ä½ å­¦è¿‡ Trie æ ‘ç»“æ„ï¼Œåº”è¯¥å¯ä»¥çœ‹å‡ºæ¥è¿™é¢˜å°±åœ¨è€ƒå¯Ÿæœ€çŸ­å‰ç¼€é—®é¢˜ã€‚

æ‰€ä»¥å¯ä»¥æŠŠè¾“å…¥çš„è¯æ ¹åˆ—è¡¨ `dict` å­˜å…¥ `TrieSet`ï¼Œç„¶åç›´æ¥å¤ç”¨æˆ‘ä»¬å®ç°çš„ `shortestPrefixOf` å‡½æ•°å°±è¡Œäº†ï¼š

Copy

```java
String replaceWords(List<String> dict, String sentence) {
    // å…ˆå°†è¯æ ¹éƒ½å­˜å…¥ TrieSet
    TrieSet set = new TrieSet();
    for (String key : dict) {
        set.add(key);
    }
    StringBuilder sb = new StringBuilder();
    String[] words = sentence.split(" ");
    // å¤„ç†å¥å­ä¸­çš„å•è¯
    for (int i = 0; i < words.length; i++) {
        // åœ¨ Trie æ ‘ä¸­æœç´¢æœ€çŸ­è¯æ ¹ï¼ˆæœ€çŸ­å‰ç¼€ï¼‰
        String prefix = set.shortestPrefixOf(words[i]);
        if (!prefix.isEmpty()) {
            // å¦‚æœæœç´¢åˆ°äº†ï¼Œæ”¹å†™ä¸ºè¯æ ¹
            sb.append(prefix);
        } else {
            // å¦åˆ™ï¼ŒåŸæ ·æ”¾å›
            sb.append(words[i]);
        }

        if (i != words.length - 1) {
            // æ·»åŠ å•è¯ä¹‹é—´çš„ç©ºæ ¼
            sb.append(' ');
        }
    }

    return sb.toString();
}

class TrieSet { /* è§ä¸Šæ–‡ */ }

class TrieMap { /* è§ä¸Šæ–‡ */ }
```

ç»§ç»­çœ‹åŠ›æ‰£ç¬¬ 211 é¢˜ã€Œæ·»åŠ ä¸æœç´¢å•è¯ - æ•°æ®ç»“æ„è®¾è®¡ã€ï¼š

![img](images/title3.png)

è¿™é“é¢˜çš„è€ƒç‚¹å°±åœ¨äºè¿™ä¸ª `search` å‡½æ•°è¿›è¡Œé€šé…ç¬¦åŒ¹é…ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬ç»™ `TrieSet` å®ç°çš„ `hasKeyWithPattern` æ–¹æ³•ï¼Œç›´æ¥å¥—å°±è¡Œäº†ï¼š

Copy

```java
class WordDictionary {
    TrieSet set = new TrieSet();

    // åœ¨ TrieSet ä¸­æ·»åŠ å…ƒç´ 
    public void addWord(String word) {
        set.add(word);
    }

    // é€šé…ç¬¦åŒ¹é…å…ƒç´ 
    public boolean search(String word) {
        return set.hasKeyWithPattern(word);
    }
}

class TrieSet { /* è§ä¸Šæ–‡ */ }

class TrieMap { /* è§ä¸Šæ–‡ */ }
```

ä¸Šé¢åˆ—ä¸¾çš„è¿™å‡ é“é¢˜ç”¨çš„éƒ½æ˜¯ `TrieSet`ï¼Œä¸‹é¢æ¥çœ‹çœ‹ `TrieMap` çš„é¢˜ç›®ã€‚

å…ˆçœ‹åŠ›æ‰£ç¬¬ 1804 é¢˜ã€Œå®ç°å‰ç¼€æ ‘ IIã€ï¼š

![img](images/title4.png)

è¿™é¢˜å°±å¯ä»¥ç”¨åˆ° `TrieMap`ï¼Œæ¯ä¸ªæ’å…¥çš„ `word` å°±æ˜¯é”®ï¼Œæ’å…¥çš„æ¬¡æ•°å°±æ˜¯å¯¹åº”çš„å€¼ï¼Œç„¶åå¤ç”¨ `TrieMap` çš„ API å°±èƒ½å®ç°é¢˜ç›®è¦æ±‚çš„è¿™äº›å‡½æ•°ï¼š

Copy

```java
class Trie {
    // å°è£…æˆ‘ä»¬å®ç°çš„ TrieMap
    TrieMap<Integer> map = new TrieMap<>();

    // æ’å…¥ word å¹¶è®°å½•æ’å…¥æ¬¡æ•°
    public void insert(String word) {
        if (!map.containsKey(word)) {
            map.put(word, 1);
        } else {
            map.put(word, map.get(word) + 1);
        }
    }

    // æŸ¥è¯¢ word æ’å…¥çš„æ¬¡æ•°
    public int countWordsEqualTo(String word) {
        if (!map.containsKey(word)) {
            return 0;
        }
        return map.get(word);
    }

    // ç´¯åŠ å‰ç¼€ä¸º prefix çš„é”®çš„æ’å…¥æ¬¡æ•°æ€»å’Œ
    public int countWordsStartingWith(String prefix) {
        int res = 0;
        for (String key : map.keysWithPrefix(prefix)) {
            res += map.get(key);
        }
        return res;
    }

    // word çš„æ’å…¥æ¬¡æ•°å‡ä¸€
    public void erase(String word) {
        int freq = map.get(word);
        if (freq - 1 == 0) {
            map.remove(word);
        } else {
            map.put(word, freq - 1);
        }
    }
}

class TrieMap { /* è§ä¸Šæ–‡ */ }
```

åæ­£éƒ½æ˜¯ç›´æ¥å¥—æ¨¡æ¿ï¼Œä¹Ÿæ²¡ä»€ä¹ˆæ„æ€ï¼Œå†çœ‹æœ€åä¸€é“é¢˜ç›®å§ï¼Œè¿™æ˜¯åŠ›æ‰£ç¬¬ 677 é¢˜ã€Œé”®å€¼æ˜ å°„ã€ï¼š

![img](images/title5.png)

è¿™é“é¢˜è¿˜æ˜¯æ ‡å‡†çš„ `TrieMap` çš„åº”ç”¨ï¼Œç›´æ¥çœ‹ä»£ç å§ï¼š

Copy

```java
class MapSum {
    // å°è£…æˆ‘ä»¬å®ç°çš„ TrieMap
    TrieMap<Integer> map = new TrieMap<>();

    // æ’å…¥é”®å€¼å¯¹
    public void insert(String key, int val) {
        map.put(key, val);
    }

    // ç´¯åŠ æ‰€æœ‰å‰ç¼€ä¸º prefix çš„é”®çš„å€¼
    public int sum(String prefix) {
        List<String> keys = map.keysWithPrefix(prefix);
        int res = 0;
        for (String key : keys) {
            res += map.get(key);
        }
        return res;
    }
}

class TrieMap { /* è§ä¸Šæ–‡ */ }
```

Trie æ ‘è¿™ç§æ•°æ®ç»“æ„çš„å®ç°åŸç†å’Œé¢˜ç›®å®è·µå°±è®²å®Œäº†ï¼Œå¦‚æœä½ èƒ½å¤Ÿçœ‹åˆ°è¿™é‡Œï¼ŒçœŸå¾—ç»™ä½ é¼“æŒã€‚

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘æœ€è¿‘å†™çš„å›¾è®ºç®—æ³•ä»¥åŠæœ¬æ–‡è®²çš„ Trie æ ‘ç®—æ³•ï¼Œéƒ½å’Œã€Œæ ‘ã€è¿™ç§åŸºæœ¬æ•°æ®ç»“æ„ç›¸å…³ï¼Œæ‰€ä»¥æˆ‘æ‰ä¼šåœ¨åˆ·é¢˜æ’ä»¶ä¸­é›†æˆ [æ‰‹æŠŠæ‰‹åˆ· 100 é“äºŒå‰æ ‘é¢˜ç›®](https://mp.weixin.qq.com/s/OE1zPVPj0V2o82N4HtLQbw) çš„åŠŸèƒ½ã€‚

æœ€åï¼Œçº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œï¼Œæˆ‘å»ºè®®æœ€å¥½äº²æ‰‹å®ç°ä¸€éä¸Šé¢çš„ä»£ç ï¼Œå»æŠŠé¢˜ç›®åˆ·ä¸€éï¼Œæ‰èƒ½å¯¹ Trie æ ‘æœ‰æ›´æ·±å…¥çš„ç†è§£ã€‚

ä¹‹åæˆ‘å‡†å¤‡ç»§ç»­è®²è§£ä¸€äº›åŸºæœ¬æ•°æ®ç»“æ„åœ¨é«˜çº§æ•°æ®ç»“æ„æˆ–å®é™…ç®—æ³•é¢˜ä¸­çš„åº”ç”¨ï¼Œå¤§å®¶æœŸå¾…å°±å¥½ã€‚